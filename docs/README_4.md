# Практика 4. Слежение за объектами через нахождение соответствий

## Цели

__Цель данной работы__ - знакомство с трекингом объектов; реализация трекинга объектов, включающая детектирование объектов на каждом кадре и решение задачи о назначениях. Для решения задачи о назначениях использовать венгерский алгоритм или алгоритм полного перебора.

В репозиторий `CV-SUMMER-CAMP` была включена готовая реализация венгерского алгоритма от Леонида Бейненсона (добавлена в [`opencv_contrib`][opencv_extra_tracking]). Пошаговое описанеи алгоритма тренига представлено в [ файле Google Docs][practice4_googledocs].

__Структура исходного кода__

   - include/tracking_by_matching.hpp - заголовочный файл с объявлением класса, реализующего трекинг;
   - src/tracking_by_matching.cpp - реализация методов класса трекинга (с использованием задачи о назначениях);
   - src/kuhn_munkres.hpp - заголовочный файл с объявлением класса, реализующего решение задачи  о назначениях;
   - src/kuhn_munkres.cpp - реализация методов класса для решения задачи о назначениях;
   - samples/practice4.cpp - пример использования разработанных кодов для трекинга.

## Задачи

__Основные задачи:__

 1. Ознакомиться с исходным кодом трекинга.
 1. Скачать модель для детектирования объектов [mobilenet-ssd][mobilenetssd].
 1. Запустить пример `practice4`, удостовериться в его работоспособности.
 1. Модифицикация кода: добавить возможность детектировать ОПРЕДЕЛЕННОЕ подмножество классов из всех доступных.

__Дополнительные задачи:__
 1. Разработать собственную реализацию решения задачи о назначениях, используя:
      - алгоритм полного перебора
      или
      - венгерский алгоритм.
 1. Модификация кода: добавить возможность выбора наилучшего варианта в случае, когда нейросеть относит данный объект к двум (и более) разным классам.
 
 ## Общая последовательность действий
 1. Скачать актуальную версию исходных кодов (получить данные с репозитория `itlab-vision/CV-SUMMER-CAMP`). 
 1. Скачать модель для детектирования объектов [mobilenet-ssd][mobilenetssd].
 1. Запустить пример `practice4`, удостовериться в его работоспособности, разобрать реализацию.
 1. Модифицировать код согласно заданию.
 1. Выполнить [дополнительные задачи][addtasks].
 
 ## Детальная инструкция по выполнению работы
  
 1. в папке `<openvino_dir>/deployment_tools/tools/model_downloader/`  запустить скрипт downloader.py с параметрами --name mobilenet-ssd --output <destination_folder> 

        ```bash
        $ cd "C:\Intel\computer_vision_sdk\deployment_tools\tools\model_downloader"
        $ python downloader.py --name mobilenet-ssd --output <destination_folder>
        ```  
       Файл `list_topologies.yml`, расположенный в папке `C:\Intel\computer_vision_sdk\deployment_tools\tools\model_downloader`, содержит параметры, необходимые для корректной конвертации кадра для детектора.
 1. Создать копию файла `<project_source>/src/practice4.cpp` и назвать ее `<project_source>/src/practice4_YOUR_NAME.cpp`. Далее изменять код только в файле `<project_source>/src/practice4_YOUR_NAME.cpp`, но не в `<project_source>/src/practice4.cpp`.
 1. Ознакомиться с исходным кодом трекинга.
 1. Убедиться, что проект успешно собирается и создается новый исполняемый файл `<project_build>/bin/practice4_YOUR_NAME.exe`.
 1. Запустить проект, указав все необходимые аргументы командной строки. В качестве тестового видеороклика использовать видео `catdog.mp4` из папки `data`.
 1. Повысить наглядность трекинга, изменить размер тип и размер шрифта, каждому классу назначить свой цвет, и т.д.
 1. В файле `practice4_YOUR_NAME.cpp` в классе `DnnObjectDetector` изменить функцию `detect` таким образом, чтобы она могла детектировать только некоторое подмножество классов.
 1. В файле `practice4_YOUR_NAME.cpp` изменить чтение параметра `desired_class_id` таким образом, чтобы можно было передавать массивы (например передавать строку, в которой имена классов разделены пробелом, и парсить эту строку). 
 1. Решить задачи из списка [Дополнительные задачи][addtasks]. 
 
 
<!-- LINKS -->
[mobilenetssd]: https://github.com/chuanqi305/MobileNet-SSD
[practice4_googledocs]: https://docs.google.com/document/d/1ebMY3juwGKqPhYSeU6drE68QVnjm7Ki3NvJcTYKOblg/edit
[opencv_extra_tracking]: https://github.com/opencv/opencv_contrib/tree/master/modules/tracking
[addtasks]: README_4.md#Задачи
